# JazzArchitect：再帰的確率文法に基づくジャズ和声生成システム

**概要**

本論文では、Rohrmeier (2020) の再帰的確率文脈自由文法フレームワークに基づくジャズコード進行生成システム JazzArchitect を紹介する。本システムは C++ で実装され、JUCE オーディオフレームワークと統合することで、リアルタイムオーディオ合成と MIDI 出力機能を提供する。15 パラメータのスタイルベクトルを通じて、ビバップ、クールジャズ、モーダルジャズなど 9 種類の異なるジャズスタイルのコード進行を生成できる。システムは 3 つの主要な代理規則（トライトーン代理、バックドアドミナント、コルトレーンチェンジ）および Smither (2019) のガイドトーンボイスリーディング最適化を実装している。本論文ではシステムアーキテクチャ、アルゴリズム設計、実装の詳細について述べる。

**キーワード**：ジャズ和声、確率文脈自由文法、コード進行生成、ボイスリーディング、音楽情報検索

---

## 1. 序論

### 1.1 研究動機

ジャズ和声は、その複雑なコード進行と豊富な代理規則で知られている。伝統的なジャズ即興演奏者は長年の学習を通じてこれらの規則を習得するが、コンピュータ音楽生成システムにとって、この音楽知識をシミュレートすることは依然として大きな課題である。

既存の音楽生成手法は主に 2 つのカテゴリに分類される：

1. **データ駆動型手法**：深層学習（LSTM、Transformer など）を使用してコーパスから和声パターンを学習
2. **ルールベース手法**：音楽理論の規則に基づいて生成

データ駆動型手法は滑らかな結果を生成できるが、解釈可能性と制御可能性に欠ける。ルールベース手法は生成プロセスを正確に制御できるが、従来の実装は硬直しがちである。

### 1.2 研究目的

本研究は両アプローチの利点を組み合わせることを目的とする：

1. Rohrmeier (2020) が提案した再帰文法フレームワークを採用し、理論的基盤を提供
2. 確率的重み付けにより規則選択を制御し、生成の多様性を増加
3. スタイルパラメータシステムを実装し、時代を超えたジャズスタイル生成を可能に
4. 完全なオーディオ合成と MIDI 出力機能を提供

### 1.3 貢献

本研究の主な貢献は以下の通り：

- Rohrmeier (2020) PCFG フレームワークの C++ での完全実装
- 9 種類のジャズスタイルプリセットをサポートする 15 パラメータスタイルベクトルシステムの設計
- 3 つの主要な代理規則とガイドトーンボイスリーディング最適化の統合
- グラフィカルユーザーインターフェースを備えたスタンドアロンアプリケーションの開発

---

## 2. 関連研究

### 2.1 ジャズ和声の形式文法

Steedman (1984) は最初にジャズコードシーケンスを形式文法を用いて分析し、ジャズ和声を言語構造として扱うことを提案した。この研究は基本的な生成規則を定義したが、確率的重み付けには対処しなかった。

Rohrmeier (2020) はこのフレームワークを拡張し、以下のコア概念を含む再帰文法を提案した：

- **延長（Prolongation）**：機能的に等価なコードの繰り返しまたは展開
- **準備（Preparation）**：ターゲットコードを準備するドミナント機能コード
- **代理（Substitution）**：機能的に等価なコードの置換

### 2.2 確率文脈自由文法

Harasim ら (2018, 2020) は PCFG を Jazz Harmony Treebank (JHT) に適用し、150 曲のジャズスタンダードから規則重みを抽出した。この手法は形式文法の構造性と統計手法の柔軟性を組み合わせている。

### 2.3 ボイスリーディング理論

Smither (2019) はジャズ和声のためのガイドトーンボイスリーディング理論を提案した。コア概念は以下の通り：

- **ガイドトーン**：各コードの第 3 音と第 7 音
- **スムーズなボイスリーディング**：隣接するコードのガイドトーンは最小音程で移動すべき
- **目標コスト**：理想的なボイスリーディングコストは 2 半音以下

### 2.4 代理規則

ジャズ和声における一般的な代理規則：

| 代理タイプ | 元のコード | 代理コード | 理論的根拠 |
|-----------|-----------|-----------|-----------|
| トライトーン代理 | V7 | bII7 | 共有されるトライトーン音程 |
| バックドアドミナント | V7 | bVII7 | 短調からの借用 |
| コルトレーンチェンジ | I | 長 3 度サイクル | コルトレーンスタイル |

---

## 3. システムアーキテクチャ

### 3.1 全体アーキテクチャ

JazzArchitect は階層化アーキテクチャ設計を採用：

```
ユーザーインターフェース層
├── JUCE GUI
└── パラメータコントロール

生成層
├── PCFG エンジン
│   ├── ジェネレータ
│   └── ルールライブラリ
└── スタイルエンジン
    ├── 代理処理
    ├── ボイスリーディング最適化
    └── スタイルパラメータ

コア層
├── コードシンボル
├── ピッチクラス
└── 音程計算

出力層
├── コードシンセサイザー（8 ボイスポリフォニー）
└── MIDI エクスポーター
```

### 3.2 モジュール説明

#### コアモジュール
- **PitchClass**：ピッチクラス表現（0-11、C=0）
- **ChordQuality**：コード品質列挙（maj7、min7、dom7、hdim7、dim7、aug）
- **ChordSymbol**：ルート、品質、テンション、オルタレーションを含む完全なコードシンボル

#### 文法モジュール
- **NonTerminal**：非終端記号（S、T、D、SD、PREP、PROL）
- **GrammarRule**：生成規則定義
- **PCFG**：確率文脈自由文法エンジン
- **Generator**：トップダウン導出エンジン

#### スタイルモジュール
- **StyleVector**：15 パラメータスタイルベクトル
- **StylePresets**：9 種類のスタイルプリセット
- **StyleEngine**：生成と後処理の統合

#### 代理モジュール
- **TritoneSubstitution**：V7 から bII7
- **BackdoorSubstitution**：V7 から bVII7
- **ColtraneSubstitution**：長 3 度サイクル代理
- **SubstitutionEngine**：統一代理プロセッサ

#### ボイスリーディングモジュール
- **GuideTone**：第 3 音と第 7 音の分析
- **VoiceLeadingOptimizer**：ボイスリーディングコストの最小化

#### 合成モジュール
- **ChordSynth**：8 ボイスポリフォニックコードシンセサイザー
- **ADSREnvelope**：ADSR エンベロープ
- **SynthVoice**：単一合成ボイス

#### MIDI モジュール
- **MIDIExporter**：標準 MIDI ファイルエクスポート

---

## 4. 文法エンジン

### 4.1 非終端記号

システムは以下の非終端記号を定義：

| 記号 | 名前 | 機能 |
|-----|------|------|
| S | 開始 | 開始記号（曲全体）|
| T | トニック | トニック領域 |
| D | ドミナント | ドミナント領域 |
| SD | サブドミナント | サブドミナント領域 |
| PREP | 準備 | 準備領域 |
| PROL | 延長 | 延長領域 |

### 4.2 コア生成規則

#### 延長規則
延長規則は機能的に等価なコードを繰り返しまたは展開：

- トニック延長：T は T T を生成
- ドミナント延長：D は D D を生成
- 右延長：T は T PROL を生成
- 左延長：T は PROL T を生成

#### 準備規則
準備規則はドミナント機能コードを挿入：

- 完全終止：T は D T を生成
- 変格終止：T は SD T を生成
- ii-V パターン：D は PREP D を生成
- 副属和音準備：PREP は ii を生成
- 重属準備：PREP は V/V を生成

#### 代理規則
代理規則は単項生成：

- トライトーン代理：V7 は bII7 を生成
- バックドアドミナント：V7 は bVII7 を生成
- コルトレーンチェンジ：I は長 3 度サイクルを生成

### 4.3 規則確率

規則確率は StyleVector によって制御される。ii-V パターンの場合：

- 準備を選択する確率 = StyleVector.iiVPreference
- 延長を選択する確率 = 1 - iiVPreference

### 4.4 導出アルゴリズム

システムはトップダウン再帰導出を採用：

1. 開始記号 S で導出木を初期化
2. 木に非終端記号が含まれている間：
   - 最左の非終端記号 N を選択
   - N に適用可能な規則を取得
   - スタイルパラメータに従って規則を重み付け
   - 確率に従って規則 r をサンプリング
   - r を適用し、N を RHS 記号で置換
3. 終端記号をキーのコードシンボルにマッピング
4. コード進行を返す

---

## 5. スタイルシステム

### 5.1 StyleVector パラメータ

StyleVector は生成動作を制御する 15 のパラメータを含む：

| パラメータ | 範囲 | 説明 |
|-----------|------|------|
| tritoneSubProb | 0.0-1.0 | トライトーン代理確率 |
| iiVPreference | 0.0-1.0 | ii-V 進行優先度 |
| modalInterchange | 0.0-1.0 | モーダルインターチェンジ頻度 |
| chromaticApproach | 0.0-1.0 | クロマチックアプローチ頻度 |
| dominantChainDepth | 1-5 | ドミナントチェーン最大深度 |
| rhythmDensity | 0.0-1.0 | コードチェンジ密度 |
| extensionLevel | 0.0-1.0 | テンション使用レベル |
| backdoorProb | 0.0-1.0 | バックドアドミナント確率 |
| coltraneProb | 0.0-1.0 | コルトレーンチェンジ確率 |
| minorBorrowing | 0.0-1.0 | 短調借用頻度 |
| diminishedUsage | 0.0-1.0 | ディミニッシュコード使用頻度 |
| deceptiveResolution | 0.0-1.0 | 偽終止確率 |
| plagalCadence | 0.0-1.0 | 変格終止確率 |
| suspensionUsage | 0.0-1.0 | サスペンション使用頻度 |
| pedalPointProb | 0.0-1.0 | ペダルポイント確率 |

### 5.2 スタイルプリセット

システムは 9 種類のスタイルプリセットを提供：

| スタイル | トライトーン | ii-V | モーダル | テンション | 特徴 |
|---------|-------------|------|---------|-----------|------|
| ビバップ | 0.30 | 0.90 | 0.20 | 0.70 | 高速 ii-V、豊富なテンション |
| クール | 0.20 | 0.70 | 0.30 | 0.50 | 遅いテンポ、空間的 |
| モーダル | 0.10 | 0.30 | 0.70 | 0.30 | 少ない機能進行、モーダルカラー |
| ハードバップ | 0.35 | 0.85 | 0.25 | 0.60 | ブルースの影響、強いリズム |
| ポストバップ | 0.40 | 0.60 | 0.60 | 0.80 | モダン和声、複雑な構造 |
| スウィング | 0.15 | 0.80 | 0.10 | 0.40 | 伝統的進行、簡潔 |
| フュージョン | 0.30 | 0.50 | 0.50 | 0.90 | 豊富なテンション、モーダルミックス |
| コンテンポラリー | 0.35 | 0.40 | 0.70 | 0.85 | モダンテクニック、自由な構造 |
| ブルース | 0.20 | 0.60 | 0.40 | 0.50 | ブルース進行、パラレルコード |

### 5.3 スタイルエンジン

StyleEngine は生成ワークフローを統合：

1. PCFG を使用して基本進行を生成
2. 代理エンジンを適用して代理規則を処理
3. ボイスリーディングオプティマイザーで最適化
4. 最終進行を返す

---

## 6. 代理規則

### 6.1 トライトーン代理

トライトーン代理は V7 と bII7 が同じトライトーン音程を共有することに基づく：

- G7 のトライトーン：B-F（第 3 音と第 7 音）
- Db7 のトライトーン：F-Cb（第 3 音と第 7 音）

両者は B/Cb と F を共有するため、互換可能である。

実装では、tritoneSubProb に従って V7 を bII7 に置換する。新しいルートは元のルートに 6 半音（トライトーン音程）を加えて計算。

### 6.2 バックドアドミナント

バックドアドミナントは短調借用に由来し、V7 を bVII7 に置換：

- 伝統的：G7 は Cmaj7 に解決
- バックドア：Bb7 は Cmaj7 に解決

実装は backdoorProb で制御。新しいルートは元のルートに 3 半音（短 3 度上行）を加算。

### 6.3 コルトレーンチェンジ

コルトレーンチェンジはジョン・コルトレーンの「ジャイアント・ステップス」に由来し、単純な進行を長 3 度サイクルに置換：

- 伝統的：I コード
- コルトレーン：III7 - bVImaj7 - bII7 - V7 - I

実装では単一の I コードを 5 つのコードのシーケンスに展開。

---

## 7. ボイスリーディング最適化

### 7.1 ガイドトーン分析

Smither (2019) によると、ガイドトーンは各コードの第 3 音と第 7 音：

| コードタイプ | 第 3 音 | 第 7 音 |
|------------|---------|---------|
| Cmaj7 | E (4) | B (11) |
| Dm7 | F (5) | C (0) |
| G7 | B (11) | F (5) |

### 7.2 ボイスリーディングコスト

2 つのコード間のボイスリーディングコストはガイドトーンの最小移動量として定義：

コスト = |第3音1 - 第3音2| + |第7音1 - 第7音2|

音程はオクターブ等価を考慮して最小値で計算。

### 7.3 最適化アルゴリズム

VoiceLeadingOptimizer は隣接するコードの各ペアをチェックし、コストが高すぎる場合は代理を試行：

1. 隣接するコードの各ペアについて
2. ボイスリーディングコストを計算
3. コスト > 2 の場合：
   - 最初のコードにトライトーン代理を試行
   - 新しいコストを計算
   - 新しいコストが低ければ代理を適用
4. 最適化された進行を返す

---

## 8. オーディオ合成

### 8.1 シンセサイザーアーキテクチャ

ChordSynth は 3 種類の音色をサポートする 8 ボイスポリフォニックコードシンセサイザー：

| 音色 | 合成方式 | 特徴 |
|------|---------|------|
| エレクトリックピアノ | FM 合成 | ローズスタイル、減衰変調 |
| オルガン | 加算合成 | ハモンドスタイル、倍音積層 |
| パッド | 減算合成 | 鋸歯状波 + ローパスフィルター |

### 8.2 エンベロープ設定

各 SynthVoice は独立した ADSR エンベロープを含む：

| 音色 | アタック | ディケイ | サステイン | リリース |
|------|---------|---------|-----------|---------|
| エレクトリックピアノ | 5ms | 300ms | 0.3 | 400ms |
| オルガン | 10ms | 50ms | 0.9 | 100ms |
| パッド | 200ms | 500ms | 0.7 | 800ms |

### 8.3 コードボイシング

ChordSymbol.getMIDINotes() は MIDI ノートを生成：

1. ルート MIDI 値を計算 = baseOctave * 12 + root
2. ルートノートを追加
3. コード品質の各音程について、対応するノートを追加
4. 各テンションについて、対応するノートを追加
5. ノートリストを返す

---

## 9. 実装詳細

### 9.1 開発環境

- **言語**：C++17
- **フレームワーク**：JUCE 7.x
- **ビルドシステム**：CMake 3.22+
- **プラットフォーム**：macOS（ARM64/x86_64）

### 9.2 ファイル構造

```
cpp/
├── Source/
│   ├── Core/           # コアクラス
│   ├── Grammar/        # 文法エンジン
│   ├── Style/          # スタイルシステム
│   ├── Substitution/   # 代理規則
│   ├── VoiceLeading/   # ボイスリーディング
│   ├── Synthesis/      # オーディオ合成
│   ├── MIDI/           # MIDI 出力
│   ├── Main.cpp
│   ├── MainComponent.h
│   └── MainComponent.cpp
├── JUCE/               # JUCE サブモジュール
├── CMakeLists.txt
└── build/
```

### 9.3 ビルド手順

```bash
cd cpp
mkdir build && cd build
cmake ..
cmake --build . --config Release
```

### 9.4 アプリケーション仕様

- **ファイルサイズ**：約 11 MB
- **最小要件**：macOS 10.13+
- **オーディオエンジン**：CoreAudio、48 kHz
- **CPU 使用率**：非常に低い（< 1%）

---

## 10. ユーザーインターフェース

### 10.1 インターフェースレイアウト

```
┌─────────────────────────────────────────────────────────────┐
│ Jazz Architect                                              │
├─────────────────────────────────────────────────────────────┤
│ スタイル: [ビバップ v]  キー: [C    v]  音色: [E.Piano  v]  │
│ BPM: [===120===]    長さ: [===8===]                        │
│                                                             │
│ [生成]  [再生]  [停止]  [MIDI エクスポート]                 │
├─────────────────────────────────────────────────────────────┤
│                    コード進行                               │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐     │
│  │Dm7   │ │G7    │ │Cmaj7 │ │A7    │ │Dm7   │ │G7    │     │
│  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └──────┘     │
├─────────────────────────────────────────────────────────────┤
│ トライトーン [═══○═══]  ii-V [═══════○]  モーダル [═○════]  │
│ テンション   [═════○═]                                      │
└─────────────────────────────────────────────────────────────┘
```

### 10.2 操作フロー

1. スタイルプリセットを選択（またはパラメータスライダーを調整）
2. キーと長さを選択
3. 「生成」をクリックして新しい進行を作成
4. 「再生」をクリックして再生（音色を選択）
5. 「MIDI エクスポート」をクリックしてファイルをエクスポート

---

## 11. 結論と今後の課題

### 11.1 成果のまとめ

本研究は JazzArchitect システムの実装に成功し、以下の目標を達成：

1. **理論統合**：Rohrmeier (2020) PCFG フレームワークの完全実装
2. **スタイル制御**：15 パラメータスタイルベクトルと 9 種類のプリセット
3. **代理規則**：トライトーン、バックドア、コルトレーン代理
4. **ボイス最適化**：Smither (2019) ガイドトーンボイスリーディング
5. **実用ツール**：GUI、オーディオ合成、MIDI 出力

### 11.2 今後の課題

1. **コーパストレーニング**：Jazz Harmony Treebank から規則確率を抽出
2. **評価統合**：MusDr 評価指標を追加
3. **聴取実験**：A/B 比較テストの実施
4. **楽譜表示**：五線譜視覚化の追加
5. **リアルタイム MIDI**：外部シンセサイザーへの接続
6. **クロスプラットフォーム**：Windows/Linux バージョン

---

## 参考文献

1. Rohrmeier, M. (2020). Towards a Syntax of Jazz Harmony. *Music Theory and Analysis*, 7(1), 1-62.

2. Steedman, M. J. (1984). A generative grammar for jazz chord sequences. *Music Perception*, 2(1), 52-77.

3. Smither, S. (2019). Guide-tone voice leading in jazz. *Music Theory Online*, 25(2).

4. Harasim, D., Finkensiep, C., Ericson, P., O'Donnell, T. J., & Rohrmeier, M. (2020). The jazz harmony treebank. *Proceedings of ISMIR 2020*.

5. Tymoczko, D. (2006). The geometry of musical chords. *Science*, 313(5783), 72-74.

6. Wu, S. L., & Yang, Y. H. (2020). The jazz transformer on the front line: Exploring the shortcomings of AI-composed music through quantitative measures. *Proceedings of ISMIR 2020*.

7. Granroth-Wilding, M., & Steedman, M. (2014). A robust parser-interpreter for jazz chord sequences. *Journal of New Music Research*, 43(4), 355-374.

---

## 付録 A：コード品質音程表

| コード品質 | 音程（半音）|
|-----------|------------|
| MAJ7 | 0, 4, 7, 11 |
| MIN7 | 0, 3, 7, 10 |
| DOM7 | 0, 4, 7, 10 |
| HDIM7 | 0, 3, 6, 10 |
| DIM7 | 0, 3, 6, 9 |
| AUG | 0, 4, 8 |
| MAJ6 | 0, 4, 7, 9 |
| MIN6 | 0, 3, 7, 9 |

## 付録 B：非終端記号から終端記号へのマッピング

| 非終端 | 機能 | 一般的な終端 |
|-------|------|-------------|
| T | トニック | Imaj7、vi7、iii7 |
| D | ドミナント | V7、vii-7 |
| SD | サブドミナント | IV、ii7 |
| PREP | 準備 | ii7、IV |

---

*JazzArchitect v1.0 - 2026 年 1 月 2 日*
